<?php
/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 * @category app
 * @package views/vias
 * @author Lázaro Nieto Aranda
 * @date 16-abr-2015
 * @time 15:08:51
 */
 ?>
 <?php View::flash(); ?>
<?php
//echo Tag::js('multi/jquery');
echo Tag::js('multi/jquery-ui');
echo Tag::js('multi/jquery.multisortable'); //Adiciona un archivo javascript (/app/public/javascript/jquery/jquery.kumbiaphp.js)
?>
<script type="text/javascript">
    $(function() {
        $('table').kgrid({
            order_to:   $.KumbiaPHP.publicPath+"vias/vias/listar/",
            order_attr: '<?php echo (APP_AJAX) ? 'class="js-link js-spinner"' : ''; ?>'
        });
    });
</script>

<script type="text/javascript">
    $(function($){
        $('ul.sortable').multisortable();
				
        $("ul").sortable({
            connectWith : ['ul'],
            opacity: 0.3,
            //placeholder: 'highlight',
            placeholder: "lm-placeholder", revert: true,
            forcePlaceholderSize: 'true', 
            helper: "clone",
            delay: 600,
            update : function(event, ui) {
                var or, ord;
                if (ui.sender){
                    or = ui.sender.attr('id');
                } else {
                    or = this.id;
                }
                ord = ui.item.parent().attr('id');
                orden(or, ord);
            }
        });
              
        $( "li" ).disableSelection();

        function orden(via1,via2){
            var ordenElementos = $('#'+via1).sortable("toArray").toString();
            $('#resultado').append(via1+"->"+ordenElementos+"<br/>");
            var or = $('#'+ via2).sortable("toArray").toString();
            $('#resultado').append(via2+"->"+or+"<br/>");
            $('#resultado').append(via2+"->"+or[0]+"<br/>");
			//$('li.selected').removeClass('selected');
        }
			
        $('.separador').click(function(){
            $('li.selected').removeClass('selected');
        });
    });
			
    $('.separador').click(function(){
        $('li.selected').removeClass('selected');
    });
</script>

<div class="container shell-view">

    <?php View::process($page_module, $page_title, $set_title); ?>

    <?php if($vias) { ?>
	<?php foreach($vias as $row): ?>
            <div class="separador">Vía <?php echo $row->id; ?></div>
            <div class="row" style="width:<?php echo $row->largo *3.333; ?>px; height:60px; padding-bottom:2px; border: 1px solid #7C7C7C; border-bottom: 3px solid black;" id="via<?php echo $row->id; ?>">
				<ul id="v<?php echo $row->id; ?>" class="sortable" style="width:<?php echo $row->largo; ?>px; height:60px; list-style: none;">
                                    <?php foreach($row->getVagon() as $vag): ?>
                                        <?php $tipo = Load::model('vias/tipo')->find($vag->tipo_id); ?>
                                        <?php $cajas = Load::model('vias/caja')->find_by_sql("select * from caja where vagon_id = '$vag->id'"); ?>
					<li style="cursor: pointer; display:inline-block;height: 60px; ">
                                            <table style="width:<?php echo $tipo->medida*3.333 ?>; margin-right:2px;">
                                                <tr>
                                                    <?php $cont =0; $img=0;?>
                                                    <?php if (count($cajas)==2){
                                                        foreach ($cajas as $caja):?>
                                                    <td><?php echo $caja->id_caja; ?></td>
                                                    <?php $cont++; $img++?>
                                                    <?php endforeach;}?>
                                                    <?php if (count($cajas)==1 and ($tipo->tipo=="aleman" or $tipo->tipo=="portacontenedor")){
                                                        if($cajas->id_caja=='' ){echo'<td> --- </td>';}
                                                            else{echo '<td>'.$cajas->id_caja.'</td>'; $img=1;}
                                                        echo'<td> --- </td>';
                                                        $cont=2;
                                                    }?>
                                                    <?php if (count($cajas)==1 and ($tipo->tipo !=="aleman" and $tipo->tipo !=="portacontenedor")){
                                                        if($cajas->id_caja=='' ){echo'<td> --- </td>';}
                                                            else{echo '<td>'.$cajas->id_caja.'</td>'; $img=1;}
                                                        $cont=1;
                                                    }?>
                                                </tr>
                                                <tr><td colspan="<?php echo $cont ?>"><?php echo Html::img('vagones/'.$tipo->tipo.$img.'.png', $alt=NULL, 'width:'.$tipo->medida*3.333 ) ?><?php //echo img_tag(“carro.gif”, “width: 100”, “border: 0”) ?></td></tr>
                                                <tr><td colspan="<?php echo $cont ?>"><?php echo $vag->id_vagon ?></td></tr>
                                            </table>
                                        </li>
                                    <?php endforeach; ?>
				</ul>
			</div>
			<div class="row separador" style="width:100%; height:30px;"></div>
        <?php endforeach; ?>
    <?php } ?>
   
                        <div id="resultado" class="row"></div>
            
            <table class="table table-bordered table-hover table-striped table-condensed table-responsive">
                <thead>
                    <tr>
                        <th>VÍA</th>                        
                        <th data-order="largo">LONGITUD</th>
                    </tr>
                </thead>
                <tbody>
                    <?php if($vias) { ?>
                        <?php foreach($vias as $row): ?>
                            <tr>
                                <td><?php echo $row -> id; ?></td>                                
                                <td><?php echo $row -> largo; ?></td>

                            </tr>
                        <?php endforeach; ?>
                    <?php } ?>
                </tbody>
            </table>
  
</div>

